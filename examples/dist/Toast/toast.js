import{isObj}from"../common/utils";const defaultOptions={type:"text",mask:!1,show:!0,zIndex:1e3,duration:2e3,position:"middle",forbidClick:!1,selector:"#lin-toast"};let queue=[],currentOptions={...defaultOptions};function parseOptions(e){return isObj(e)?e:{message:e}}function getContext(){const e=getCurrentPages();return e[e.length-1]}function Toast(e){const t=((e={...currentOptions,...parseOptions(e)}).context||getContext()).selectComponent(e.selector);if(t)return delete e.context,delete e.selector,t.clear=()=>{t.setData({show:!1}),e.onClose&&e.onClose()},queue.push(t),t.setData(e),clearTimeout(t.timer),e.duration>0&&(t.timer=setTimeout(()=>{t.clear(),queue=queue.filter(e=>e!==t)},e.duration)),t;console.warn("未找到 lin-toast 节点，请确认 selector 及 context 是否正确")}const createMethod=e=>t=>Toast({type:e,...parseOptions(t)});Toast.loading=createMethod("loading"),Toast.success=createMethod("success"),Toast.fail=createMethod("fail"),Toast.clear=()=>{queue.forEach(e=>{e.clear()}),queue=[]},Toast.setDefaultOptions=e=>{Object.assign(currentOptions,e)},Toast.resetDefaultOptions=()=>{currentOptions={...defaultOptions}};export default Toast;