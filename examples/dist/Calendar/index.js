import{getYearMonthDay,getDate,isCurrentMonth,isEqual,isEqAndLt,isEqAndGt}from"./utils.js";const nowDate=(new Date).getTime();Component({options:{addGlobalClass:!0},properties:{show:{type:Boolean,value:!1,observer:"handleShow"},value:{type:String,optionalTypes:[String,Number]},title:{type:String,value:"日期选择"},showTitle:{type:Boolean,value:!0},showConfirm:{type:Boolean,value:!0},confirmText:{type:String,value:"确定"},disabledConfirm:{type:Boolean,value:!1},rowHeight:{type:[String,Number]},restText:{type:String,value:"重置"},showReset:{type:Boolean,value:!1},disabledReset:{type:Boolean,value:!1},disabledBeforeDate:{type:Number,optionalTypes:[String,Number]},disabledAfterDate:{type:String,optionalTypes:[String,Number]},disabledRangeDate:Array,disabledDate:Array,disabled:Boolean,poppable:{type:Boolean,value:!0}},data:{daysList:["日","一","二","三","四","五","六"],time:nowDate,visibeDaysList:[],selectTime:""},observers:{"time,selectTime,disabledBeforeDate,disabledAfterDate,disabledRangeDate,disabledDate,disabled":function(e,t,i,a,s,n,r){const{year:l,month:o}=getYearMonthDay(e.date),h=getDate(l,o,1),g=h.getDay(),m=h-60*g*60*1e3*24,d=[];for(let l=0;l<42;l++){const o=new Date(m+60*l*60*1e3*24);d.push({...this.getVisibeTimeObj(o),isCurrentMonth:isCurrentMonth(o,e.date),isSelected:t&&isEqual(o,t.date),isDisabled:r||i&&isEqAndLt(o,i)||a&&isEqAndGt(o,a)||s&&this.handleRangeDate(o,s)||n&&n.some(e=>isEqual(e,o))})}this.setData({visibeDaysList:d})}},methods:{handleRangeDate(e,t){if(Array.isArray(t)&&0!==t.length){if(1===t.length){const i=new Date(t[0]);if(isEqAndLt(i,e))return!0}if(t.length>=2){const i=new Date(t[0]),a=new Date(t[1]);if(isEqAndLt(i,e)&&isEqAndGt(a,e))return!0}}return!1},handleShow(e){const t=this.properties.value;if(t&&e){const e=new Date(t);this.setData({selectTime:this.getVisibeTimeObj(e),time:this.getTime(t)})}},onMaskClick(){this.triggerEvent("mask-click")},handleValue(){let e=null;return e=this.properties.value?new Date(this.properties.value):new Date(nowDate),{label:`${e.getFullYear()}年${e.getMonth()+1}月`,date:e,times:e.getTime()}},onLabelClick(e){const t=e.target.dataset.index,i=this.data.visibeDaysList[t];isEqual(i.times,this.data.selectTime.times)||i.isDisabled||(this.setData({selectTime:i,time:this.getTime(i.times)}),this.triggerEvent("change",i.times))},prevMonth(){const e=new Date(this.data.time.times);e.setMonth(e.getMonth()-1),this.setData({time:this.getTime(e.getTime())}),this.triggerEvent("prevMonth",e)},nextMonth(){const e=new Date(this.data.time.times);e.setMonth(e.getMonth()+1),this.setData({time:this.getTime(e.getTime())}),this.triggerEvent("nextMonth",e)},prevYear(){const e=new Date(this.data.time.times);e.setFullYear(e.getFullYear()-1),this.setData({time:this.getTime(e.getTime())}),this.triggerEvent("prevYear",e)},nextYear(){const e=new Date(this.data.time.times);e.setFullYear(e.getFullYear()+1),this.setData({time:this.getTime(e.getTime())}),this.triggerEvent("nextYear",e)},onConfirmClick(){this.triggerEvent("confirm",this.data.selectTime.times)},onResetClick(){this.setData({selectTime:""}),this.triggerEvent("reset")},onClose(){this.triggerEvent("close")},getTime:e=>({label:`${(e=new Date(e)).getFullYear()}年${e.getMonth()+1}月`,date:e,times:e.getTime()}),getVisibeTimeObj:e=>({label:e.getDate(),date:e,times:e.getTime()})},created:function(){},attached:function(){},ready:function(){const e=this.handleValue();this.setData({time:e})},moved:function(){},detached:function(){}});