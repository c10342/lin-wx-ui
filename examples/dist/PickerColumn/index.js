import{isObj}from"../common/utils";Component({options:{addGlobalClass:!0,multipleSlots:!0},externalClasses:["custom-class","active-class"],properties:{initialOptions:{type:Array,value:[],observer:"updateOptionsList"},itemHeight:{type:Number,value:44,observer:"updateTranslateY"},valueKey:{type:String,value:"text"},defaultIndex:{type:Number,value:0,observer:"updateIndex"},visibleItemCount:{type:Number,value:6},topVisible:{type:Number,value:2}},data:{translateY:110,transitionStyle:"transition: all 300ms",currentIndex:0,optionsList:[]},methods:{getValue(){const{currentIndex:t,optionsList:e}=this.data;return e[t]},updateOptionsList(){this.setData({optionsList:this.properties.initialOptions})},updateIndex(){let{defaultIndex:t}=this.properties;t=this.adjustIndex(t);const e=this.findNotDisabled(t);null!=e&&(t=e),this.setData({currentIndex:t}),this.setTransYByIndex(t)},updateTranslateY(){const{itemHeight:t,topVisible:e}=this.properties,{optionsList:s}=this.data,i=t*e+t/2;this.startTranslateY=i,this.endTranslateY=i-s.length*t,this.setData({translateY:i})},onTouchMove(t){let{translateY:e}=this.data;const{itemHeight:s}=this.properties,i=t.touches[0].clientY;e-=this.startY-i,this.startY=i,e>=this.startTranslateY+s?e=this.startTranslateY+s:e<=this.endTranslateY&&(e=this.endTranslateY),this.setData({translateY:e})},onTouchStart(t){this.setData({transitionStyle:"transition: none"}),this.startY=t.touches[0].clientY},onTouchEnd(){this.setData({transitionStyle:"transition: all 300ms"});const{translateY:t}=this.data,e=this.data.optionsList.length;let s=this.getIndex(t);s=s<0?0:s,s=s>e-1?e-1:s,s=this.findNotDisabled(s),null!=s&&(this.setTransYByIndex(s),this.emitChange(s))},onClick(t){const e=t.currentTarget.dataset.index,{optionsList:s}=this.data;s[e]&&s[e].disabled||(this.setTransYByIndex(1*e),this.emitChange(1*e))},getIndex(t){const{itemHeight:e,topVisible:s}=this.properties;let i=(e*s-(t-=e/2))/e;const a=e/2,n=t%e;return i=n>=0?n<=a?Math.ceil(i):Math.floor(i):-n<a?Math.floor(i):Math.ceil(i),i},setTransYByIndex(t){const{itemHeight:e}=this.properties;this.setData({translateY:this.startTranslateY-t*e})},emitChange(t){const{currentIndex:e,optionsList:s}=this.data;t!==e&&(this.triggerEvent("change",{index:t,data:s[t]}),this.setData({currentIndex:t}))},adjustIndex(t){const{optionsList:e}=this.data;return t=(t=t<0?0:t)>e.length-1?e.length-1:t},findNotDisabled(t){const{optionsList:e}=this.data;for(let s=t;s<e.length;s++)if(!this.isDisabled(e[s]))return s;for(let s=t-1;s>=0;s--)if(!this.isDisabled(e[s]))return s;return null},isDisabled:t=>isObj(t)&&t.disabled,setIndex(t){this.setData({currentIndex:t}),this.setTransYByIndex(t)},getOptionText(t){const{value:e}=this.properties;return isObj(t)&&e in t?t[e]:t},setValue(t){const{optionsList:e}=this.data;for(let s=0;s<e.length;s++)if(this.getOptionText(e[s])===t)return this.setIndex(s);return Promise.resolve()}},created:function(){this.startY=0,this.startTranslateY=0,this.endTranslateY=0},attached:function(){},ready:function(){this.updateTranslateY(),this.updateIndex(),this.updateOptionsList()},moved:function(){},detached:function(){}});